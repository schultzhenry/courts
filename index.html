<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <title>Federal Judiciary</title>
  <script src="d3.js"></script>
  <script src="d3-selection-multi.min.js"></script>
  <!-- <script src="https://d3js.org/d3.v4.min.js"></script> -->
  <!-- <script src="https://d3js.org/d3-scale-chromatic.v0.3.min.js"></script> -->
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=EB+Garamond:400,400i,500,500i,600,600i,700,700i&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Barlow+Condensed:300,300i,400,400i&display=swap" rel="stylesheet">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-composite-projections/1.0.1/d3-composite-projections.min.js"></script> -->
  <link rel="stylesheet" type ="text/css" href ="overview.css"/>
</head>
<body>
  <div id="view">
    <div id="left-panel">
      <div id="left-header" class="header">
        <h1>Federal Judiciary of the United States</h1>
      </div>
      <div id="left-vis" class="vis">
        <div id="supreme-level">
          <h2>Supreme Court</h2>
          <div class="court-space">
          </div>
        </div>
        <div id="appellate-level">
          <h2>Appellate Courts</h2>
          <div class="court-space">
          </div>
        </div>
        <div id="district-level">
          <h2>District Courts</h2>
          <div class="court-space">
          </div>
        </div>
      </div>
      <div id="left-footer" class="footer"></div>
    </div>
    <div id="right-panel">
      <div id="right-header" class="header">
        <h1></h1>
      </div>
      <div id="right-vis" class="vis"></div>
      <div id="right-footer" class="footer"></div>
    </div>
    <div id="right-panel-toggle" class="button">
      <p id="right-panel-toggle-text">‚Üê</p>
    </div>
  </div>
  <script src="constants.js"></script>
  <script type="text/javascript">

    function f(string) {
      return string.replace(' ', '-');
    }

    function populateJudges(selection, name, size) {
      // CONSTANTS
      var w = 42;
      var h = 18;
      var pad = 2;
      var center = {x: w/2, y: h/2};
      var forceStrength = 0.07;
      var radius = 2;
      // APPEND SVG
      var svg = selection.selectAll(".court")
        .append("svg")
        .attr("width", w)
        .attr("height", h)
        .attr("class", "judges-thumbnail")
        .attr("id", f(name)+"-judges");
      // CREATE NODE LIST
      var nodes = d3.range(size).map(function(i) { return {r: radius}; });
      // CREATE SIMULATION
      var simulation = d3.forceSimulation(nodes)
        .velocityDecay(0.1)
        .force('center', d3.forceCenter(w / 2, h / 2))
        .force("x", d3.forceX().strength(forceStrength).x(center.x))
        .force("y", d3.forceY().strength(forceStrength).y(center.y))
        .force("collide", d3.forceCollide().radius(function(d) { return d.r * 1.22; }).iterations(1))
        .on("tick", ticked);
      // ADD NODES TO SVG
      var node = svg.append("g")
        .attr("class", "nodes")
        .selectAll("circle")
        .data(nodes).enter().append("circle")
        .attr("r", function(d){  return d.r });
      function ticked() { node
        .attr('cx', function (d) { return d.x = Math.max(radius, Math.min(w - radius, d.x)); })
        .attr('cy', function (d) { return d.y = Math.max(radius, Math.min(h - radius, d.y)) * 0.97; });
      }
      simulation.nodes(nodes).on("tick", ticked);
    }

    function loadLevel(level, name) {
      var selection = d3.select("#"+level+"-level .court-space");
      if (level === 'appellate' ) {
        // NEST COURTS BY CIRCUIT
        const nest = d3.nest().key(d => d.column).entries(appellate_dictionary);
        // ADD GROUP FOR EACH CIRCUIT
        const group = selection.selectAll('.appellate-column')
        	.data(nest).enter()
        	.append('div')
          .attr('id', function(d) { return String(d.key).replace(' ', '-'); })
          .attr('class', 'appellate-column');
        // ADD APPROPRIATE NUMBER OF COURTS PER GROUP
        group.selectAll('.court')
          .data(d => d.values).enter()
          .append('div').attr('class', function(d) { return 'court '+String(d.jdcode).split(',').join(' '); })
          .attr("id", function(d) { return f(d.name); });
        // COURT LABELS
        group.data(appellate_dictionary)
          .append('p').attr('class', 'court-label')
          .text(function(d) { return d.name; })
          .attr('id', function(d) { return String(d.name)+'-label'; });
        // POPULATE JUDGES
        appellate_dictionary.forEach(function(entry) {
          selection = d3.select("div #"+f(entry.name)+".appellate-column");
          populateJudges(selection, f(entry.name), entry.size);
        });
      }
      else if (level === 'district') {
        // NEST COURTS BY CIRCUIT
        const nest = d3.nest().key(d => d.column).entries(district_dictionary);
        // ADD GROUP FOR EACH CIRCUIT
        const group = selection.selectAll('.appellate-column')
        	.data(nest).enter()
        	.append('div').attr('class', 'appellate-column')
          .attr("id", function(d) { return f(d.key); });
        // ADD COLUMN FOR CIRCUIT WITH NO DISTRICTS
        selection.append('div')
          .attr('class', 'appellate-column')
          .attr("id", function(d) { return f('Federal Circuit'); });
        // ADD APPROPRIATE NUMBER OF COURTS PER GROUP
        group.selectAll('.court-box')
        	.data(d => d.values).enter()
        	.append('div').attr('class', 'court-box')
          .attr("id", function(d) { return f(d.name)+'-box'; })
          .append('div').attr('class', function(d) { return 'court '+String(d.jdcode); })
          .attr("id", function(d) { return f(d.name); });
        // ADD LABELS
        selection.selectAll('.court-box')
          .data(district_dictionary).append('p').attr('class', 'court-label')
          .attr('id', function(d) { return f(d.name)+'-label'; })
          .text(function(d) { return d.name; });
        // POPULATE JUDGES
        district_dictionary.forEach(function(entry) {
          selection = d3.select("div #"+f(entry.name)+"-box.court-box");
          populateJudges(selection, f(entry.name), entry.size);
        });
      }
      else if (level === 'supreme') {

        var selection = selection.append('div').attr('class', 'appellate-column');

        selection.selectAll(".court")
          .data(supreme_dictionary)
          .enter().append("div")
          .attr("id", function(d) { return d.name;})
          .attr("class", "court");

        selection.selectAll('.court-label')
          .data(supreme_dictionary)
          .enter()
          .append("p")
          .attr('class', 'court-label')
          .attr('id', level+'-label' )
          .text(function(d) { return d.name; });

        populateJudges(selection, 'supreme', supreme_dictionary[0].size);
      }
    };

    // load each court level
    loadLevel('supreme', 'Supreme Court');
    loadLevel('appellate', 'Appellate');
    loadLevel('district', 'District');

  </script>
  <script src="map.js"></script>
  <script src="interaction.js"></script>
</body>
